---
title: "Progetto di Fondamenti di Scienza dei Dati"
author: "Denis Gasparollo"
date: "2022-08-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Il datasets presi in considerazione sono 3: 

 * [link](https://espace.library.uq.edu.au/view/UQ:dfe5027) il quale contiene informazioni su data breach e ransomware tra il 2004 e l'inizio del 2020 raccolti dall'università del Queensland;
 * [link](https://en.wikipedia.org/wiki/List_of_data_breaches), che non è che il risultato di uno scrapping;
 * [link](https://docs.google.com/spreadsheets/d/1Je-YUdnhjQJO_13r8iTeRxpU2pBKuV6RVRHoYCgiMfg/edit#gid=322165570).
 
Per lo scrapping della pagina vedi script nel file *wiki_scrap.R*. <!--schiarire-->

```{r warning=FALSE, message=FALSE}
library(readr)
library(tidyr)
library(ggplot2)
library(dplyr)
library(modelr)
library(stringr)
library(corrplot)
```

# IMPORT DEI DATI

Il dataset è composto da 43 features e 1145 record.

```{r warning=FALSE, message=FALSE}
# lettura dati
queensland <- read_delim("data/dataset.csv", delim = ';', na = c("Unknown", "Missing", "NA"))
wiki <- read_csv("data/wiki.csv", na = "unknown")
data_breaches_2018_update <- read_csv("data/Data Breaches - 2018 update.csv",comment = "#")
```

Si sfrutta la funzione 'read_delim()' per il fatto che il CSV una il punto e virgola come delimitatore.

<!--TODO: descrivere i dataset-->
## FEATURES

<!--TODO: riduurre la lista solo a features effettivamete utilizzate-->
* **Year**: anno in cui l'attacco è avvenuto ;
* **Organisation**: organizzazione attaccata ;
* **Critical industry**: ;
* **Organisation size**: dimensione dell'organizzazione ;
* **Level of digital intensity** ;
* **Sector**: settore di competenza dell'azienda ;
* **Country**:  ;
* **Cyber security role**: ;
* **Cyber security frameworks** ;
* **Education and awareness policy** ;
* **Policy** ;
* **Prevention, Detection and Recovery** ;
* **Improper network segmentation** ;
* **Inappropriate remote access** ;
* **Absence of encryption**: indicca l'assenza di crittografia;
* **Detector** ;
* **Restructuring after attack** ;
* **Bribe/ransom paid** ;
* **Free identity or credit theft monitoring** ;
* **Additional disclosure of information** ;
* **Number of users affected**: utenti che sono stati colpiti dall'attacco;
* **Overall nature of attack** ;
* **Attack type**: descrive il tipo di attacco;
* **Attacker**: descrive l'attaccante;
* **Attack vector**: mezzo usato per effettuare l'attacco;
* **Impact on data** ;
* **Aspect of Confidentiality-Integrity-Availability triad affected** ;
* **Individual(s) name(s) leaked/exposed** ;
* **Address(es) leaked/exposed** ;
* **Other personally identifiable information (PII) leaked/exposed** ;
* **Track 1 - Credit card details leaked/exposed** ;
* **Track 2 - Credit card details leaked/exposed** ;
* **Social security number/tax number leaked/exposed** ;
* **Subsequent fraudulent use of data** ;
* **Investigation** ;
* **Undertook investigation** ;
* **Litigation by public** ;
* **Penalties/settlement paid or actions imposed** ;
* **Imposed penalties or actions on organisation** ;
* **Fines issued by government or relevant body** ;
* **Settlement paid** ;
* **Effect on share price** ;
* **Summary**: descrizione dell'attacco ;

## ANALISI FEATURES

Prima di analizzare la correlazione tra coppie di variabili devo convertire le stringhe (variabili categoriali) in valori numerici (variabili quantitativi).


Per convertire una variabile categoriale in variabile quantitativa devo convertire il tipo `factor` in `numeric` per riuscire a calvolare la correlazione tra le variabili: per fare ciò devo fare le seguenti conversioni `character` > `factor` > `integer` > `character` > `numeric` per evitare la *type cohercion* nel caso in cui vado a provare ad eseguoire la  conversione da `integer` a `numeric`.

```{r message=FALSE, warning=FALSE}
#fattorizzazione 'queensland'
queensland <- queensland %>% mutate(`Number of users affected` = as.numeric(`Number of users affected`))

queensland_factorized <- queensland %>% 
  mutate_if(is.character, as.factor) %>% 
  mutate_if(is.factor, unclass) %>%
  mutate_if(is.integer, as.character) %>%
  mutate_if(is.character, as.numeric)

#fattorizzazione 'data_breaches_2018_update'
data_breaches_2018_update_factorized <- data_breaches_2018_update %>%
  mutate_if(is.character, as.factor) %>% 
  mutate_if(is.factor, unclass) %>%
  mutate_if(is.integer, as.character) %>%
  mutate_if(is.character, as.numeric)

#fattorizzazione 'wiki'
wiki <- wiki %>% mutate(Year = as.numeric(Year), Records = as.numeric(str_remove_all(wiki$Records, ",")))

wiki_facorized <- wiki %>%
  mutate_if(is.character, as.factor) %>% 
  mutate_if(is.factor, unclass) %>%
  mutate_if(is.integer, as.character) %>%
  mutate_if(is.character, as.numeric)
```


```{r warning=FALSE, message=FALSE}
#correlazione 'queensland'
corrplot.mixed(cor(queensland_factorized), lower = "nunmber", upper = "ellipse")
```

```{r}
#correlazione 'data_breaches_2018_update'
corrplot.mixed(cor(data_breaches_2018_update), lower = "nunmber", upper = "ellipse")
```

```{r}
#correlazione 'data_breaches_2018_update'
corrplot.mixed(cor(data_breaches_2018_update), lower = "nunmber", upper = "ellipse")
```


#NORMALIZZAZIONE

```{r message=FALSE, warning=FALSE}
queensland <- queensland %>% select(c(-...44, -`Effect on share price`, -`Overall nature of attack`))
wiki <- wiki %>% select(-Sources)
data_breaches_2018_update <- data_breaches_2018_update %>% 
  select(c(Entity : `1st source link`, `source name`, -YEAR, -`NO OF RECORDS STOLEN`)) %>%
  rename(YEAR = `YEAR(2)`)
```

<!--Sscrivere commento inerente alle variabili escluse-->

# DOMANDE
1. Come sono cresciuti gli attacchi con il passare degli anni?
2. Qual'è il settore che è stato maggiormente colpito?

## Come sono cresciuti col passare gli anni gil attacchi?
Dai 3 dataset vado ad estrarre le features che riguardano il nome dell'azienda che è stata vittima dell'attacco o data-breach, l'anno, il paese, il settore di competenza e le tecniche di attacco.
Lo scopo di estrarre tali features è andare a studiare la crescita o la diminuzione del numero di attacchi.
```{r warning=FALSE, message=FALSE}
split_date <- function(){
  res <- list()
  
  for(year in wiki_attacks$Year)
    res <- c(res, as.numeric(str_split(year, "-")[[1]][1]))
  return(unlist(res))
}
```


```{r warning=FALSE, message=FALSE}
wiki_attacks <- wiki %>% select(c(Year, Entity, `Organization type`, Method)) %>%
  rename(Sector = `Organization type`, `Attack type` = Method)
wiki_attacks <- wiki_attacks %>% mutate(Year = split_date())

data_breaches_2018_update_attacks <- data_breaches_2018_update %>% 
  select(c(YEAR, Entity, ORGANISATION, `METHOD OF LEAK`)) %>%
  rename(Year = YEAR, Sector = ORGANISATION, `Attack type` = `METHOD OF LEAK`)

queensland_attacks <- queensland %>% select(c(Year, Organisation, Sector, `Attack type`)) %>%
  rename(Entity = Organisation)

attacks <- union_all(union_all(wiki_attacks, data_breaches_2018_update_attacks), queensland_attacks)
```

```{r warning=FALSE, message=FALSE}
#grafico andamento del numero di attacchi in funzione del tempo
attack_year <- attacks %>% group_by(Year) %>%
  summarise(attack = n())

ggplot(attack_year, aes(x = Year, y = attack, )) + 
  geom_line()
  
```
<!--da fare analisi-->

## Qual'è il settore che è stato maggiormente colpito?

```{r warning=FALSE, message=FALSE}
#grafico andamento del numero di attacchi in funzione al settore
records <- dim(attacks)[1]

attack_sector <- attacks %>%
  group_by(Sector) %>%
  summarise(attacks = n()) %>%
  filter(attacks > 30) %>%
  arrange(-attacks)

attack_sector %>% ggplot() +
  geom_bar(aes(x = "", y = attacks, fill = Sector), stat = "identity", color = "white") +
  #annotate("text", x = "", y = attacks, label = Sector) +
  coord_polar("y", start = 0) +
  theme_void()
```
<!--da fare analisi-->
